<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<title>OpenICE Diagnostics</title>
		<style type="text/css" media="screen">
			body {
				font-family: sans-serif;
			}
			table{
			border-collapse:collapse;
			border:1px solid #000000;
			}

			table td{
			border:1px solid #000000;
			}

			h2 {
				font-size: 12pt;
			}
			.description {
				float:left;
				margin-left: 10%;
				font-size: 10pt;
				font-style: italic;
				width:70%;
				margin-right:20%;
				margin-bottom: 20pt;
			}
			#connectionStatus {
				position:fixed;
				top:0;
				/*background-color:#FFFFFF80;*/
				display:inline;
				right:0;
			}
		</style>
		<script src="bower_components/angular/angular.js"></script>
		<script language="javascript" type="text/javascript" src="js/jquery.min.js"></script>
		<script language="javascript" type="text/javascript" src="build/numerics.js"></script>

		<base target="_blank"/>
	</head>
	<body ng-app="diagnostics">

	<h1>OpenICE System Diagnostics</h1>
	<span class="description">This page shows current realtime data values from the OpenICE system.  It is meant to surface available data for diagnostic and testing purposes while other, more advanced UIs, UXs, and apps are developed to represent and interact with this data model in more meaningful ways.  Descriptions of each data topic have also been included.  <br/><br/>Note:
	<ul><li>For convenience Unique Device Identifiers (UDIs) have been replaced on this page with Make/Model for a device when it is available from the DeviceIdentity topic.</li><li>Timestamps are presented in the timezone of the lab in Cambridge, MA for convenience though they are transported by the OpenICE system in Universal Time Coordinates.</li></ul></span><br/>
	<div id="connectionStatus">
	<h2><span class="status"></span></h2>
	</div>
	<h2>Status:&nbsp;<span class="status"></span></h2>
	<span class="description">"Status" (also in the upper right) indicates whether this page is currently connected to the OpenICE web gateway.  The OpenICE web gateway is a <a href="http://www.nodejs.org">node.js</a> server program that uses an MD PnP DDS add-on for node.js to retrieve DDS information and share it over the web.  It utilizes <a href="http://socket.io">socket.io</a> for connectivity between client and server.</span>
	<form id="partitionForm">
	<h2>Partition&nbsp;<select id="partitionBox" multiple=""></select></h2>
	</form>
	<span class="description">Partitions are a DDS concept.  A publisher and subscriber must be "in" a common logical partition before the writers and readers they contain will "match" and begin sharing information.  The concept transcends topology.  A portable device accompanying an ambulatory patient connected via a wifi network can still be in the same logical partition as the devices in that patient's room attached to a physical ethernet network.  And a subscriber subscribed in that partition will receive data from both devices.  Thus a singular "ICE environment" defined by partition obviates a lot of issues with patient transport, ambulatory, and room preparation scenarios.  Our first candidate for a partitioning scheme is this one partition per-patient paradigm.  But options abound for other partitions existing in parallel perhaps for device type, assigned unit, etc.  This dropdown box collects all the partitions for all available publications and allows this page to "tune into" one partition in particular.  Currently in the lab several 'environments' are configured with their own partition name.</span><br/><br/>
	<div ng-controller="DiagnosticController as di">
		<openice url="dev.openice.info"></openice>


		<script type="text/ng-template" id="data.html">

		</script>
		<div ng-repeat="t in topics">
		<h2>{{t.name}}</h2><br/>
		<!--
		<span class="description">{{t.description}}</span>
		<table>
			<tr>
				<td ng-repeat="field in t.fields">{{field.name}}</td>
			</tr>
			<tr ng-repeat="row in t.dataTable.rows">
				<span>{{row.latest_sample.data}}</span>
				<td ng-repeat="field in t.fields" ng-switch on="field.type" ng-init=" value = pathIndex(field.key ? row.keyValues : (field.meta ? row : row.latest_sample),field.id); suffix = field.suffix ">
				   <img  ng-switch-when="icon" ng-src="data:{{value.content_type||'image/png'}};base64, {{value.image}}"></img>
				   <span ng-switch-when="udi">{{deviceNames[value]}}{{suffix}}</span>
				   <span ng-switch-when="time_t">{{value|time_t}}{{suffix}}</span>
				   <span ng-switch-when="dob">{{value.month+"/"+value.day+"/"+value.century+value.year}}{{suffix}}</span>
				   <span ng-switch-when="json">{{JSON.stringify(value)}}{{suffix}}</span>
				   <span ng-switch-default>{{value}}{{suffix}}</span>
				</td>
			</tr>
		</table>
		-->
		<my-table openice="openice" table-name="{{t.name}}" domain="{{domain}}" partition="partition">
		  <div ng-repeat="row in table.rows">
		    {{row.rowId}}I see this
		  </div>
		</my-table>
		</div>
		
	</div>
	<script language="javascript" type="text/javascript">
	  /*for(var i = 0; i < tables.length; i++) {
	    tables[i].write(document);
	  }*/
	</script>

	</body>
</html>
